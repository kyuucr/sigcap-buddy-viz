<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>SigCap Buddy Data Visualization</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL" crossorigin="anonymous"></script>
  <style>
    .status-online::before,
    .status-offline::before {
      display: inline-block;
      content: "";
      vertical-align: -.125em;
      background-repeat: no-repeat;
      background-size: 1rem 1rem;
      width: 1rem;
      height: 1rem;
      margin-right: .2rem;

    }
    .status-online::before {
      background-image: url("data:image/svg+xml,<svg width='16' height='16' viewBox='0 0 16 16' fill='%230F0' class='bi bi-circle-fill' xmlns='http://www.w3.org/2000/svg'><circle cx='8' cy='8' r='8'/></svg>");
    }
    .status-offline::before {
      background-image: url("data:image/svg+xml,<svg width='16' height='16' viewBox='0 0 16 16' fill='%23F00' class='bi bi-dash-circle-fill' xmlns='http://www.w3.org/2000/svg'><path d='M16 8A8 8 0 1 1 0 8a8 8 0 0 1 16 0M4.5 7.5a.5.5 0 0 0 0 1h7a.5.5 0 0 0 0-1z'/></svg>");
    }
  </style>
</head>
<body>
  <nav class="navbar navbar-expand-lg bg-body-tertiary">
    <div class="container-fluid">
      <a class="navbar-brand" href="index.html">SigCap Buddy Data</a>
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarText" aria-controls="navbarText" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse" id="navbarText">
        <ul class="navbar-nav me-auto mb-2 mb-lg-0">
          <li class="nav-item">
            <a class="nav-link" href="#dl-tput-plot-label">DL Tput</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="#ul-tput-plot-label">UL Tput</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="#latency-plot-label">Latency</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="#wifi-rssi-plot-label">Wi-Fi RSSI</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="#heartbeat-label">Heartbeats</a>
          </li>
        </ul>
        <span class="navbar-text" id="lastupdate-text"></span>
      </div>
    </div>
  </nav>
  <div class="container-md">
    <h3>Device <span class="device-id"></span></h3>
    <div class="accordion">
      <div class="accordion-item">
        <h2 class="accordion-header" id="latency-idle-boxplot-speedtest-eth0-label">
          <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#latency-idle-boxplot-speedtest-eth0-collapse" aria-expanded="false" aria-controls="latency-idle-boxplot-speedtest-eth0-collapse">
            Download dataset for&nbsp;<span class="device-id"></span>
          </button>
        </h2>
        <div id="latency-idle-boxplot-speedtest-eth0-collapse" class="accordion-collapse collapse" aria-labelledby="latency-idle-boxplot-speedtest-eth0-label">
          <div class="accordion-body">
            <ul>
              <li><a id="dl-heartbeat-csv">Download Heartbeat CSV</a></li>
              <li><a id="dl-heartbeat-json">Download Heartbeat JSON</a></li>
              <li><a id="dl-latency-csv">Download Latency CSV</a></li>
              <li><a id="dl-latency-json">Download Latency JSON</a></li>
              <li><a id="dl-throughput-csv">Download Throughput CSV</a></li>
              <li><a id="dl-throughput-json">Download Throughput JSON</a></li>
              <li><a id="dl-wifi-scan-csv">Download Wi-Fi Scan CSV</a></li>
              <li><a id="dl-wifi-scan-json">Download Wi-Fi Scan JSON</a></li>
              <li><a id="dl-csv">Download all CSV & JSON data</a></li>
              <li><a id="dl-log">Download raw logs</a></li>
            </ul>
          </div>
        </div>
      </div>
    </div>
    <p></p>

    <h4 id="dl-tput-plot-label">Downlink throughput</h4>
    <div id="dl-tput-plot"></div>
    <p></p>

    <h4 id="dl-tput-boxplot-label">Hourly downlink throughput</h4>
    <div class="accordion">
      <div class="accordion-item">
        <h2 class="accordion-header" id="dl-tput-boxplot-iperf-eth0-label">
          <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#dl-tput-boxplot-iperf-eth0-collapse" aria-expanded="false" aria-controls="dl-tput-boxplot-iperf-eth0-collapse">
            iperf eth0
          </button>
        </h2>
        <div id="dl-tput-boxplot-iperf-eth0-collapse" class="accordion-collapse collapse" aria-labelledby="dl-tput-boxplot-iperf-eth0-label">
          <div class="accordion-body">
            <div id="dl-tput-boxplot-iperf-eth0"></div>
          </div>
        </div>
      </div>
      <div class="accordion-item">
        <h2 class="accordion-header" id="dl-tput-boxplot-iperf-wlan0-label">
          <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#dl-tput-boxplot-iperf-wlan0-collapse" aria-expanded="false" aria-controls="dl-tput-boxplot-iperf-wlan0-collapse">
            iperf wlan0
          </button>
        </h2>
        <div id="dl-tput-boxplot-iperf-wlan0-collapse" class="accordion-collapse collapse" aria-labelledby="dl-tput-boxplot-iperf-wlan0-label">
          <div class="accordion-body">
            <div id="dl-tput-boxplot-iperf-wlan0"></div>
          </div>
        </div>
      </div>
      <div class="accordion-item">
        <h2 class="accordion-header" id="dl-tput-boxplot-iperf-wlan1-label">
          <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#dl-tput-boxplot-iperf-wlan1-collapse" aria-expanded="false" aria-controls="dl-tput-boxplot-iperf-wlan1-collapse">
            iperf wlan1
          </button>
        </h2>
        <div id="dl-tput-boxplot-iperf-wlan1-collapse" class="accordion-collapse collapse" aria-labelledby="dl-tput-boxplot-iperf-wlan1-label">
          <div class="accordion-body">
            <div id="dl-tput-boxplot-iperf-wlan1"></div>
          </div>
        </div>
      </div>
      <div class="accordion-item">
        <h2 class="accordion-header" id="dl-tput-boxplot-speedtest-eth0-label">
          <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#dl-tput-boxplot-speedtest-eth0-collapse" aria-expanded="false" aria-controls="dl-tput-boxplot-speedtest-eth0-collapse">
            Ookla eth0
          </button>
        </h2>
        <div id="dl-tput-boxplot-speedtest-eth0-collapse" class="accordion-collapse collapse" aria-labelledby="dl-tput-boxplot-speedtest-eth0-label">
          <div class="accordion-body">
            <div id="dl-tput-boxplot-speedtest-eth0"></div>
          </div>
        </div>
      </div>
      <div class="accordion-item">
        <h2 class="accordion-header" id="dl-tput-boxplot-speedtest-wlan0-label">
          <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#dl-tput-boxplot-speedtest-wlan0-collapse" aria-expanded="false" aria-controls="dl-tput-boxplot-speedtest-wlan0-collapse">
            Ookla wlan0
          </button>
        </h2>
        <div id="dl-tput-boxplot-speedtest-wlan0-collapse" class="accordion-collapse collapse" aria-labelledby="dl-tput-boxplot-speedtest-wlan0-label">
          <div class="accordion-body">
            <div id="dl-tput-boxplot-speedtest-wlan0"></div>
          </div>
        </div>
      </div>
      <div class="accordion-item">
        <h2 class="accordion-header" id="dl-tput-boxplot-speedtest-wlan1-label">
          <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#dl-tput-boxplot-speedtest-wlan1-collapse" aria-expanded="false" aria-controls="dl-tput-boxplot-speedtest-wlan1-collapse">
            Ookla wlan1
          </button>
        </h2>
        <div id="dl-tput-boxplot-speedtest-wlan1-collapse" class="accordion-collapse collapse" aria-labelledby="dl-tput-boxplot-speedtest-wlan1-label">
          <div class="accordion-body">
            <div id="dl-tput-boxplot-speedtest-wlan1"></div>
          </div>
        </div>
      </div>
    </div>
    <p></p>

    <h4 id="ul-tput-plot-label">Uplink throughput</h4>
    <div id="ul-tput-plot"></div>
    <p></p>

    <h4 id="ul-tput-boxplot-label">Hourly uplink throughput</h4>
    <div class="accordion">
      <div class="accordion-item">
        <h2 class="accordion-header" id="ul-tput-boxplot-iperf-eth0-label">
          <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#ul-tput-boxplot-iperf-eth0-collapse" aria-expanded="false" aria-controls="ul-tput-boxplot-iperf-eth0-collapse">
            iperf eth0
          </button>
        </h2>
        <div id="ul-tput-boxplot-iperf-eth0-collapse" class="accordion-collapse collapse" aria-labelledby="ul-tput-boxplot-iperf-eth0-label">
          <div class="accordion-body">
            <div id="ul-tput-boxplot-iperf-eth0"></div>
          </div>
        </div>
      </div>
      <div class="accordion-item">
        <h2 class="accordion-header" id="ul-tput-boxplot-iperf-wlan0-label">
          <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#ul-tput-boxplot-iperf-wlan0-collapse" aria-expanded="false" aria-controls="ul-tput-boxplot-iperf-wlan0-collapse">
            iperf wlan0
          </button>
        </h2>
        <div id="ul-tput-boxplot-iperf-wlan0-collapse" class="accordion-collapse collapse" aria-labelledby="ul-tput-boxplot-iperf-wlan0-label">
          <div class="accordion-body">
            <div id="ul-tput-boxplot-iperf-wlan0"></div>
          </div>
        </div>
      </div>
      <div class="accordion-item">
        <h2 class="accordion-header" id="ul-tput-boxplot-iperf-wlan1-label">
          <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#ul-tput-boxplot-iperf-wlan1-collapse" aria-expanded="false" aria-controls="ul-tput-boxplot-iperf-wlan1-collapse">
            iperf wlan1
          </button>
        </h2>
        <div id="ul-tput-boxplot-iperf-wlan1-collapse" class="accordion-collapse collapse" aria-labelledby="ul-tput-boxplot-iperf-wlan1-label">
          <div class="accordion-body">
            <div id="ul-tput-boxplot-iperf-wlan1"></div>
          </div>
        </div>
      </div>
      <div class="accordion-item">
        <h2 class="accordion-header" id="ul-tput-boxplot-speedtest-eth0-label">
          <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#ul-tput-boxplot-speedtest-eth0-collapse" aria-expanded="false" aria-controls="ul-tput-boxplot-speedtest-eth0-collapse">
            Ookla eth0
          </button>
        </h2>
        <div id="ul-tput-boxplot-speedtest-eth0-collapse" class="accordion-collapse collapse" aria-labelledby="ul-tput-boxplot-speedtest-eth0-label">
          <div class="accordion-body">
            <div id="ul-tput-boxplot-speedtest-eth0"></div>
          </div>
        </div>
      </div>
      <div class="accordion-item">
        <h2 class="accordion-header" id="ul-tput-boxplot-speedtest-wlan0-label">
          <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#ul-tput-boxplot-speedtest-wlan0-collapse" aria-expanded="false" aria-controls="ul-tput-boxplot-speedtest-wlan0-collapse">
            Ookla wlan0
          </button>
        </h2>
        <div id="ul-tput-boxplot-speedtest-wlan0-collapse" class="accordion-collapse collapse" aria-labelledby="ul-tput-boxplot-speedtest-wlan0-label">
          <div class="accordion-body">
            <div id="ul-tput-boxplot-speedtest-wlan0"></div>
          </div>
        </div>
      </div>
      <div class="accordion-item">
        <h2 class="accordion-header" id="ul-tput-boxplot-speedtest-wlan1-label">
          <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#ul-tput-boxplot-speedtest-wlan1-collapse" aria-expanded="false" aria-controls="ul-tput-boxplot-speedtest-wlan1-collapse">
            Ookla wlan1
          </button>
        </h2>
        <div id="ul-tput-boxplot-speedtest-wlan1-collapse" class="accordion-collapse collapse" aria-labelledby="ul-tput-boxplot-speedtest-wlan1-label">
          <div class="accordion-body">
            <div id="ul-tput-boxplot-speedtest-wlan1"></div>
          </div>
        </div>
      </div>
    </div>
    <p></p>

    <h4 id="latency-plot-label">Latency</h4>
    <div id="latency-plot"></div>
    <p></p>

    <h4 id="latency-idle-boxplot-label">Hourly idle latency</h4>
    <div class="accordion">
      <div class="accordion-item">
        <h2 class="accordion-header" id="latency-idle-boxplot-speedtest-eth0-label">
          <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#latency-idle-boxplot-speedtest-eth0-collapse" aria-expanded="false" aria-controls="latency-idle-boxplot-speedtest-eth0-collapse">
            Ookla eth0
          </button>
        </h2>
        <div id="latency-idle-boxplot-speedtest-eth0-collapse" class="accordion-collapse collapse" aria-labelledby="latency-idle-boxplot-speedtest-eth0-label">
          <div class="accordion-body">
            <div id="latency-idle-boxplot-speedtest-eth0"></div>
          </div>
        </div>
      </div>
      <div class="accordion-item">
        <h2 class="accordion-header" id="latency-idle-boxplot-speedtest-wlan0-label">
          <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#latency-idle-boxplot-speedtest-wlan0-collapse" aria-expanded="false" aria-controls="latency-idle-boxplot-speedtest-wlan0-collapse">
            Ookla wlan0
          </button>
        </h2>
        <div id="latency-idle-boxplot-speedtest-wlan0-collapse" class="accordion-collapse collapse" aria-labelledby="latency-idle-boxplot-speedtest-wlan0-label">
          <div class="accordion-body">
            <div id="latency-idle-boxplot-speedtest-wlan0"></div>
          </div>
        </div>
      </div>
      <div class="accordion-item">
        <h2 class="accordion-header" id="latency-idle-boxplot-speedtest-wlan1-label">
          <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#latency-idle-boxplot-speedtest-wlan1-collapse" aria-expanded="false" aria-controls="latency-idle-boxplot-speedtest-wlan1-collapse">
            Ookla wlan1
          </button>
        </h2>
        <div id="latency-idle-boxplot-speedtest-wlan1-collapse" class="accordion-collapse collapse" aria-labelledby="latency-idle-boxplot-speedtest-wlan1-label">
          <div class="accordion-body">
            <div id="latency-idle-boxplot-speedtest-wlan1"></div>
          </div>
        </div>
      </div>
    </div>
    <p></p>

    <h4 id="latency-dlload-boxplot-label">Hourly DL-load latency</h4>
    <div class="accordion">
      <div class="accordion-item">
        <h2 class="accordion-header" id="latency-dlload-boxplot-speedtest-eth0-label">
          <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#latency-dlload-boxplot-speedtest-eth0-collapse" aria-expanded="false" aria-controls="latency-dlload-boxplot-speedtest-eth0-collapse">
            Ookla eth0
          </button>
        </h2>
        <div id="latency-dlload-boxplot-speedtest-eth0-collapse" class="accordion-collapse collapse" aria-labelledby="latency-dlload-boxplot-speedtest-eth0-label">
          <div class="accordion-body">
            <div id="latency-dlload-boxplot-speedtest-eth0"></div>
          </div>
        </div>
      </div>
      <div class="accordion-item">
        <h2 class="accordion-header" id="latency-dlload-boxplot-speedtest-wlan0-label">
          <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#latency-dlload-boxplot-speedtest-wlan0-collapse" aria-expanded="false" aria-controls="latency-dlload-boxplot-speedtest-wlan0-collapse">
            Ookla wlan0
          </button>
        </h2>
        <div id="latency-dlload-boxplot-speedtest-wlan0-collapse" class="accordion-collapse collapse" aria-labelledby="latency-dlload-boxplot-speedtest-wlan0-label">
          <div class="accordion-body">
            <div id="latency-dlload-boxplot-speedtest-wlan0"></div>
          </div>
        </div>
      </div>
      <div class="accordion-item">
        <h2 class="accordion-header" id="latency-dlload-boxplot-speedtest-wlan1-label">
          <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#latency-dlload-boxplot-speedtest-wlan1-collapse" aria-expanded="false" aria-controls="latency-dlload-boxplot-speedtest-wlan1-collapse">
            Ookla wlan1
          </button>
        </h2>
        <div id="latency-dlload-boxplot-speedtest-wlan1-collapse" class="accordion-collapse collapse" aria-labelledby="latency-dlload-boxplot-speedtest-wlan1-label">
          <div class="accordion-body">
            <div id="latency-dlload-boxplot-speedtest-wlan1"></div>
          </div>
        </div>
      </div>
    </div>
    <p></p>

    <h4 id="latency-ulload-boxplot-label">Hourly UL-load latency</h4>
    <div class="accordion">
      <div class="accordion-item">
        <h2 class="accordion-header" id="latency-ulload-boxplot-speedtest-eth0-label">
          <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#latency-ulload-boxplot-speedtest-eth0-collapse" aria-expanded="false" aria-controls="latency-ulload-boxplot-speedtest-eth0-collapse">
            Ookla eth0
          </button>
        </h2>
        <div id="latency-ulload-boxplot-speedtest-eth0-collapse" class="accordion-collapse collapse" aria-labelledby="latency-ulload-boxplot-speedtest-eth0-label">
          <div class="accordion-body">
            <div id="latency-ulload-boxplot-speedtest-eth0"></div>
          </div>
        </div>
      </div>
      <div class="accordion-item">
        <h2 class="accordion-header" id="latency-ulload-boxplot-speedtest-wlan0-label">
          <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#latency-ulload-boxplot-speedtest-wlan0-collapse" aria-expanded="false" aria-controls="latency-ulload-boxplot-speedtest-wlan0-collapse">
            Ookla wlan0
          </button>
        </h2>
        <div id="latency-ulload-boxplot-speedtest-wlan0-collapse" class="accordion-collapse collapse" aria-labelledby="latency-ulload-boxplot-speedtest-wlan0-label">
          <div class="accordion-body">
            <div id="latency-ulload-boxplot-speedtest-wlan0"></div>
          </div>
        </div>
      </div>
      <div class="accordion-item">
        <h2 class="accordion-header" id="latency-ulload-boxplot-speedtest-wlan1-label">
          <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#latency-ulload-boxplot-speedtest-wlan1-collapse" aria-expanded="false" aria-controls="latency-ulload-boxplot-speedtest-wlan1-collapse">
            Ookla wlan1
          </button>
        </h2>
        <div id="latency-ulload-boxplot-speedtest-wlan1-collapse" class="accordion-collapse collapse" aria-labelledby="latency-ulload-boxplot-speedtest-wlan1-label">
          <div class="accordion-body">
            <div id="latency-ulload-boxplot-speedtest-wlan1"></div>
          </div>
        </div>
      </div>
    </div>
    <p></p>

    <h4 id="wifi-rssi-plot-label">Connected Wi-Fi RSSI</h4>
    <div id="wifi-rssi-plot"></div>
    <p></p>

    <h4 id="heartbeat-label">Heartbeats</h4>
    <table class="table table-striped-columns">
      <thead>
        <tr>
          <th>Status</th>
          <th>Start Timestamp</th>
          <th>End Timestamp</th>
        </tr>
      </thead>
      <tbody id="heartbeat">
      </tbody>
    </table>
  </div>
  <script type="module">
    import * as Plot from "https://cdn.jsdelivr.net/npm/@observablehq/plot@0.6/+esm";
    function appendData(data, yLabel, yVal, strokeVal, id, maxY) {
      let domainY;
      if (maxY !== undefined) {
        domainY = [0, maxY];
      }
      const plot = Plot.plot({
        x: {
          grid: true,
          type: "time"
        },
        y: {
          grid: true,
          label: yLabel,
          domain: domainY
        },
        color: {
          legend: true
        },
        marks: [
          Plot.ruleY([0]),
          Plot.lineY(data,
            {
              x: val => new Date(val.timestamp),
              y: yVal,
              sort: "timestamp",
              stroke: strokeVal
            }
          )
        ]
      })
      const div = document.querySelector(id);
      div.append(plot);
    }

    function appendBoxplot(data, yLabel, yVal, id, maxY) {
      let domainY;
      if (maxY !== undefined) {
        domainY = [0, maxY];
      }
      const plot = Plot.plot({
        y: {
          grid: true,
          label: yLabel,
          domain: domainY
        },
        fx: {
          interval: 1,
          label: "Hour of the day",
          labelAnchor: "right"
        },
        marks: [
          Plot.ruleY([0]),
          Plot.boxY(data, {fx: val => new Date(val.timestamp).getHours(), y: yVal})
        ]
      })
      const div = document.querySelector(id);
      div.append(plot);
    }

    function appendHeartbeat(data) {
      let mainContainer = document.getElementById("heartbeat");
      data = data.map(a => ({ last_timestamp: new Date(a.last_timestamp) }));
      data.sort((a, b) => a.last_timestamp.getTime() - b.last_timestamp.getTime());
      let reducedDates = data.reduce((prev, curr) => {
        if (prev.length === 0) {
          prev.push({
            online: true,
            start_timestamp: curr.last_timestamp,
            last_timestamp: curr.last_timestamp
          });
        } else if ((curr.last_timestamp.getTime() - prev[0].last_timestamp.getTime()) < 5400000) { // 90 minutes threshold
          prev[0].last_timestamp = curr.last_timestamp;
        } else {
          prev.unshift({
            online: true,
            start_timestamp: curr.last_timestamp,
            last_timestamp: curr.last_timestamp
          })
        }
        return prev;
      }, []);
      let filledDates = [];
      for (var j = reducedDates.length - 1; j >= 0; j--) {
        filledDates.unshift(reducedDates[j]);
        if (j > 0) {
          filledDates.unshift({
            online: false,
            start_timestamp: reducedDates[j].last_timestamp,
            last_timestamp: reducedDates[j - 1].start_timestamp
          });
        }
      }
      // console.log(filledDates)
      for (let entry of filledDates) {
        let tr = document.createElement("tr");
        tr.innerHTML = `<td>${entry.online ? "<span class=\"status-online\">Online</span>" : "<span class=\"status-offline\">Offline</span>"}</td><td>${entry.start_timestamp}</td><td>${entry.last_timestamp}</td>`;
        mainContainer.appendChild(tr);
      }
    }

    // Hardcoded dict
    const dataFilterDict = {
      "8E-51-F9-59-3F-8D": new Date("2024-01-23T12:00-0600").getTime(),
      "D8-3A-DD-4C-C5-B5": new Date("2024-01-27T00:00-0600").getTime(),
      "D8-3A-DD-4C-C5-CE": new Date("2024-01-24T00:00-0600").getTime()
    }

    if(window.location.hash) {
      const deviceId = window.location.hash.slice(1);
      const cutoff = dataFilterDict[deviceId];
      for (let item of document.getElementsByClassName("device-id")){
        item.innerHTML = deviceId;
      };
      document.getElementById("dl-csv").href = `data_${deviceId}.zip`;
      document.getElementById("dl-log").href = `rawlogs_${deviceId}.zip`;
      document.getElementById("dl-heartbeat-csv").href = `heartbeat_${deviceId}.csv`;
      document.getElementById("dl-heartbeat-json").href = `heartbeat_${deviceId}.json`;
      document.getElementById("dl-latency-csv").href = `latency_${deviceId}.csv`;
      document.getElementById("dl-latency-json").href = `latency_${deviceId}.json`;
      document.getElementById("dl-throughput-csv").href = `throughput_${deviceId}.csv`;
      document.getElementById("dl-throughput-json").href = `throughput_${deviceId}.json`;
      document.getElementById("dl-wifi-scan-csv").href = `wifi_scan_${deviceId}.csv`;
      document.getElementById("dl-wifi-scan-json").href = `wifi_scan_${deviceId}.json`;

      fetch(`last_update.json`)
        .then(function (response) {
          return response.json();
        })
        .then(function (data) {
          const div = document.querySelector("#lastupdate-text");
          div.innerHTML = `Last update: ${new Date(data.last_update)}`
        })

      fetch(`throughput_${deviceId}.json`)
        .then(function (response) {
          return response.json();
        })
        .then(function (data) {
          if (cutoff !== undefined) {
            data = data.filter(val => new Date(val.timestamp).getTime() > cutoff);
          }
          let dlData = data.filter(val => val.direction === "downlink");
          let maxTputDl = dlData.reduce((acc, curr) => ((curr.max_tput_mbps > acc) ? curr.max_tput_mbps : acc), 0)
          if (dlData.length > 0) {
            appendData(
              dlData,
              "Throughput (Mbps)",
              "max_tput_mbps",
              (val => `${val.type} ${val.interface}`),
              "#dl-tput-plot",
              maxTputDl
            );
            let dlIperfEth0 = dlData.filter(val => val.type === "iperf"
              && val.interface === "eth0");
            if (dlIperfEth0.length > 0) {
              appendBoxplot(
                dlIperfEth0,
                "Throughput (Mbps)",
                "max_tput_mbps",
                "#dl-tput-boxplot-iperf-eth0",
                maxTputDl
              );
            }
            let dlIperfWlan0 = dlData.filter(val => val.type === "iperf"
              && val.interface === "wlan0");
            if (dlIperfWlan0.length > 0) {
              appendBoxplot(
                dlIperfWlan0,
                "Throughput (Mbps)",
                "max_tput_mbps",
                "#dl-tput-boxplot-iperf-wlan0",
                maxTputDl
              );
            }
            let dlIperfWlan1 = dlData.filter(val => val.type === "iperf"
              && val.interface === "wlan1");
            if (dlIperfWlan1.length > 0) {
              appendBoxplot(
                dlIperfWlan1,
                "Throughput (Mbps)",
                "max_tput_mbps",
                "#dl-tput-boxplot-iperf-wlan1",
                maxTputDl
              );
            }
            let dlSpeedtestEth0 = dlData.filter(val => val.type === "speedtest"
              && val.interface === "eth0");
            if (dlSpeedtestEth0.length > 0) {
              appendBoxplot(
                dlSpeedtestEth0,
                "Throughput (Mbps)",
                "max_tput_mbps",
                "#dl-tput-boxplot-speedtest-eth0",
                maxTputDl
              );
            }
            let dlSpeedtestWlan0 = dlData.filter(val => val.type === "speedtest"
              && val.interface === "wlan0");
            if (dlSpeedtestWlan0.length > 0) {
              appendBoxplot(
                dlSpeedtestWlan0,
                "Throughput (Mbps)",
                "max_tput_mbps",
                "#dl-tput-boxplot-speedtest-wlan0",
                maxTputDl
              );
            }
            let dlSpeedtestWlan1 = dlData.filter(val => val.type === "speedtest"
              && val.interface === "wlan1");
            if (dlSpeedtestWlan1.length > 0) {
              appendBoxplot(
                dlSpeedtestWlan1,
                "Throughput (Mbps)",
                "max_tput_mbps",
                "#dl-tput-boxplot-speedtest-wlan1",
                maxTputDl
              );
            }
          }

          let ulData = data.filter(val => val.direction === "uplink");
          let maxTputUl = ulData.reduce((acc, curr) => ((curr.max_tput_mbps > acc) ? curr.max_tput_mbps : acc), 0)
          if (ulData.length > 0) {
            appendData(
              ulData,
              "Throughput (Mbps)",
              "max_tput_mbps",
              (val => `${val.type} ${val.interface}`),
              "#ul-tput-plot",
              maxTputUl
            );
            let ulIperfEth0 = ulData.filter(val => val.type === "iperf"
              && val.interface === "eth0");
            if (ulIperfEth0.length > 0) {
              appendBoxplot(
                ulIperfEth0,
                "Throughput (Mbps)",
                "max_tput_mbps",
                "#ul-tput-boxplot-iperf-eth0",
                maxTputUl
              );
            }
            let ulIperfWlan0 = ulData.filter(val => val.type === "iperf"
              && val.interface === "wlan0");
            if (ulIperfWlan0.length > 0) {
              appendBoxplot(
                ulIperfWlan0,
                "Throughput (Mbps)",
                "max_tput_mbps",
                "#ul-tput-boxplot-iperf-wlan0",
                maxTputUl
              );
            }
            let ulIperfWlan1 = ulData.filter(val => val.type === "iperf"
              && val.interface === "wlan1");
            if (ulIperfWlan1.length > 0) {
              appendBoxplot(
                ulIperfWlan1,
                "Throughput (Mbps)",
                "max_tput_mbps",
                "#ul-tput-boxplot-iperf-wlan1",
                maxTputUl
              );
            }
            let ulSpeedtestEth0 = ulData.filter(val => val.type === "speedtest"
              && val.interface === "eth0");
            if (ulSpeedtestEth0.length > 0) {
              appendBoxplot(
                ulSpeedtestEth0,
                "Throughput (Mbps)",
                "max_tput_mbps",
                "#ul-tput-boxplot-speedtest-eth0",
                maxTputUl
              );
            }
            let ulSpeedtestWlan0 = ulData.filter(val => val.type === "speedtest"
              && val.interface === "wlan0");
            if (ulSpeedtestWlan0.length > 0) {
              appendBoxplot(
                ulSpeedtestWlan0,
                "Throughput (Mbps)",
                "max_tput_mbps",
                "#ul-tput-boxplot-speedtest-wlan0",
                maxTputUl
              );
            }
            let ulSpeedtestWlan1 = ulData.filter(val => val.type === "speedtest"
              && val.interface === "wlan1");
            if (ulSpeedtestWlan1.length > 0) {
              appendBoxplot(
                ulSpeedtestWlan1,
                "Throughput (Mbps)",
                "max_tput_mbps",
                "#ul-tput-boxplot-speedtest-wlan1",
                maxTputUl
              );
            }
          }
        })
        .catch(function (err) {
          console.log('error: ' + err);
        });

      fetch(`latency_${deviceId}.json`)
        .then(function (response) {
          return response.json();
        })
        .then(function (data) {
          if (cutoff !== undefined) {
            data = data.filter(val => new Date(val.timestamp).getTime() > cutoff);
          }
          data = data.filter(val => val.latency_ms < 5000);
          if (data.length > 0) {
            let maxLat = data.reduce((acc, curr) => ((curr.latency_ms > acc) ? curr.latency_ms : acc), 0)
            appendData(
              data,
              "Latency (ms)",
              "latency_ms",
              (val => `${val.type} ${val.interface}`),
              "#latency-plot",
              maxLat
            );
            let idleLatEth0 = data.filter(val => val.type === "speedtest_idle"
              && val.interface === "eth0");
            if (idleLatEth0.length > 0) {
              appendBoxplot(
                idleLatEth0,
                "Latency (ms)",
                "latency_ms",
                "#latency-idle-boxplot-speedtest-eth0",
                maxLat
              );
            }
            let dlloadLatEth0 = data.filter(val => val.type === "speedtest_dl_load"
              && val.interface === "eth0");
            if (dlloadLatEth0.length > 0) {
              appendBoxplot(
                dlloadLatEth0,
                "Latency (ms)",
                "latency_ms",
                "#latency-dlload-boxplot-speedtest-eth0",
                maxLat
              );
            }
            let ulloadEth0 = data.filter(val => val.type === "speedtest_ul_load"
              && val.interface === "eth0");
            if (ulloadEth0.length > 0) {
              appendBoxplot(
                ulloadEth0,
                "Latency (ms)",
                "latency_ms",
                "#latency-ulload-boxplot-speedtest-eth0",
                maxLat
              );
            }
            let idleLatWlan0 = data.filter(val => val.type === "speedtest_idle"
              && val.interface === "wlan0");
            if (idleLatWlan0.length > 0) {
              appendBoxplot(
                idleLatWlan0,
                "Latency (ms)",
                "latency_ms",
                "#latency-idle-boxplot-speedtest-wlan0",
                maxLat
              );
            }
            let dlloadLatWlan0 = data.filter(val => val.type === "speedtest_dl_load"
              && val.interface === "wlan0");
            if (dlloadLatWlan0.length > 0) {
              appendBoxplot(
                dlloadLatWlan0,
                "Latency (ms)",
                "latency_ms",
                "#latency-dlload-boxplot-speedtest-wlan0",
                maxLat
              );
            }
            let ulloadWlan0 = data.filter(val => val.type === "speedtest_ul_load"
              && val.interface === "wlan0");
            if (ulloadWlan0.length > 0) {
              appendBoxplot(
                ulloadWlan0,
                "Latency (ms)",
                "latency_ms",
                "#latency-ulload-boxplot-speedtest-wlan0",
                maxLat
              );
            }
            let idleLatWlan1 = data.filter(val => val.type === "speedtest_idle"
              && val.interface === "wlan1");
            if (idleLatWlan1.length > 0) {
              appendBoxplot(
                idleLatWlan1,
                "Latency (ms)",
                "latency_ms",
                "#latency-idle-boxplot-speedtest-wlan1",
                maxLat
              );
            }
            let dlloadLatWlan1 = data.filter(val => val.type === "speedtest_dl_load"
              && val.interface === "wlan1");
            if (dlloadLatWlan1.length > 0) {
              appendBoxplot(
                dlloadLatWlan1,
                "Latency (ms)",
                "latency_ms",
                "#latency-dlload-boxplot-speedtest-wlan1",
                maxLat
              );
            }
            let ulloadWlan1 = data.filter(val => val.type === "speedtest_ul_load"
              && val.interface === "wlan1");
            if (ulloadWlan1.length > 0) {
              appendBoxplot(
                ulloadWlan1,
                "Latency (ms)",
                "latency_ms",
                "#latency-ulload-boxplot-speedtest-wlan1",
                maxLat
              );
            }
          }
        })
        .catch(function (err) {
          console.log('error: ' + err);
        });

      fetch(`wifi_scan_${deviceId}.json`)
        .then(function (response) {
          return response.json();
        })
        .then(function (data) {
          if (cutoff !== undefined) {
            data = data.filter(val => new Date(val.timestamp).getTime() > cutoff);
          }
          let dataConnected = data.filter(val => val.connected === true);
          if (dataConnected.length > 0) {
            appendData(
              dataConnected,
              "RSSI (dBm)",
              "rssi_dbm",
              "#F00",
              "#wifi-rssi-plot"
            );
          } else {
            const divLabel = document.querySelector("#wifi-rssi-plot-label");
            divLabel.style.display = "none";
          }
        })
        .catch(function (err) {
          console.log('error: ' + err);
        });

      fetch(`heartbeat_${deviceId}.json`)
        .then(function (response) {
          return response.json();
        })
        .then(function (data) {
          if (cutoff !== undefined) {
            data = data.filter(val => new Date(val.timestamp).getTime() > cutoff);
          }
          appendHeartbeat(data);
        })
        .catch(function (err) {
          console.log('error: ' + err);
        });
    }
  </script>
</body>
</html>
